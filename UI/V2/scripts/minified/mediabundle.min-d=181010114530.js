var SEB;!function(a){var b;!function(a){var b=function(){function a(a){this.requestUrl="/WebAPI/media",this.debug=!1,this.requestXhr=null,this.requestInProgress=!1,this.LanguageBranch="",this.yearNavigationPosition=-1,this.requestObj={PageId:"",SelectedYear:0,SelectedFeed:0,SelectedPageSize:0,SelectedOffset:0,LanguageBranch:""},this.selectors={loadmorebtn:".showmore a:eq(0)",tabheaders:".tabs-list > li a",contentlist:"ul.content-list",yearlinks:".yearlinklist a"};var b=this;b.MainBase=a,b.LanguageBranch=$("html").attr("lang"),b.requestObj.SelectedPageSize=parseInt($("#DefaultPageSize").val(),10),b.requestObj.PageId=$("#PageId").val(),b.requestObj.LanguageBranch=b.LanguageBranch,b.$doc=$(document),b.yearNavigation=$("#yearnavigation"),b.yearNavigationSelect=$(".selectlinklist"),b.LoadMore=new KWD.Layout.LayoutLoadMore(b.MainBase),b.addEvents()}return a.prototype.cssToNumber=function(a){var b=a.replace("px","");return parseInt(b,10)},a.prototype.addEvents=function(){var a=this;$(a.yearNavigationSelect.bind("change",function(b){b.preventDefault(),a.onYearSelectClick(this.value)})),$(a.selectors.loadmorebtn).bind("click",$.proxy(a.onLoadMoreBtnClick,a)),$(a.selectors.yearlinks).bind("click",$.proxy(a.onYearLinkClick,a)),$(a.selectors.tabheaders).bind("click",$.proxy(a.onTabClick,a)),$(window).bind("scroll",$.proxy(a.onWindowScroll,a)),$(window).bind("touchmove",$.proxy(a.onWindowScroll,a)),a.debug&&$(a.selectors.tabheaders).eq(1).trigger("click")},a.prototype.onWindowScroll=function(a){var b=this;b.$doc.scrollTop();b.yearNavigation.length>0&&-1===b.yearNavigationPosition&&(b.yearNavigationPosition=b.yearNavigation.offset().top)},a.prototype.onTabClick=function(a){a.preventDefault();var b=this,c=$(a.currentTarget),d=c.attr("href");b.requestInProgress===!1&&(b.requestObj.SelectedYear=0,b.requestObj.SelectedOffset=-1,-1===d.indexOf("?")&&(b.requestObj.SelectedFeed=0),c.parent().siblings().removeClass("current").end().addClass("current"),b.onYearLinkClick(a))},a.prototype.onYearSelectClick=function(a){var b=this,c=a,d=JSON.stringify(b.requestObj);b.requestInProgress===!1&&(b.requestObj.SelectedOffset=-1,b.updateRequestObj(c),d!==JSON.stringify(b.requestObj)&&$(b.selectors.contentlist).empty(),b.requestData($(b.selectors.contentlist).eq(0)))},a.prototype.onYearLinkClick=function(a){a.preventDefault();var b=this,c=$(a.currentTarget),d=c.attr("href"),e=JSON.stringify(b.requestObj);b.requestInProgress===!1&&(b.requestObj.SelectedOffset=-1,b.updateRequestObj(d),e!==JSON.stringify(b.requestObj)&&$(b.selectors.contentlist).empty(),b.requestData($(b.selectors.contentlist).eq(0)))},a.prototype.onLoadMoreBtnClick=function(a){a.preventDefault();var b=this,c=$(a.currentTarget),d=c.attr("href");b.requestInProgress===!1&&(b.updateRequestObj(d),b.requestData($(b.selectors.contentlist).eq(0)))},a.prototype.requestData=function(a){var b=this;b.requestInProgress===!1&&(b.requestInProgress=!0,b.requestXhr=$.ajax({url:b.requestUrl,type:"POST",data:b.requestObj,success:$.proxy(b.onGetData,b,a)}))},a.prototype.updateRequestObj=function(a){var b=this;if(-1!==a.indexOf("Year")||-1!==a.indexOf("Feed"))b.requestObj.SelectedOffset=0,-1!==a.indexOf("Year")&&(b.requestObj.SelectedYear=parseInt(b.MainBase.Utilities.valueOfQueryString(a,"Year"),10)),-1!==a.indexOf("Feed")&&(b.requestObj.SelectedFeed=parseInt(b.MainBase.Utilities.valueOfQueryString(a,"Feed"),10));else{var c=$(b.selectors.contentlist).children().filter(":not(.showmore)").length;b.requestObj.SelectedOffset=-1!==b.requestObj.SelectedOffset?c:0}},a.prototype.onGetData=function(a,b){var c=this;c.requestInProgress=!1,b&&c.expandList(a,b)},a.prototype.expandList=function(a,b){var c=this,d=a.clone(!0),e=b.Items.length,f=c.requestObj.SelectedOffset,g=f+e,h=$(".templates").find('[data-template-type="item"]');0!==e?($(b.Items).each(function(a,b){var e=b.Properties[0].PropertyValue,f=$();if("string"==typeof e&&0!==e.length&&(f=h.filter("."+e).eq(0)),0===f.length&&(f=h.eq(0)),0!==f.length){var g=c.LoadMore.populateTemplate(f,b);d.append(g)}}),a.replaceWith(d),window.picturefill(),g>=b.TotalNumberOfItems?$(c.selectors.loadmorebtn).hide():$(c.selectors.loadmorebtn).show()):$(c.selectors.loadmorebtn).hide()},a}();a.MediaPageBase=b}(b=a.Layout||(a.Layout={}))}(SEB||(SEB={}));var KWD;!function(a){var b;!function(a){var b=function(){function a(a){this.requestUrl="/WebAPI/content",this.loadMoreSelector="div.loadmore",this.debug=!1;var b=this;b.MainBase=a}return a.prototype.Init=function(){var a=this,b=$(a.loadMoreSelector);0!==b.length&&(b.on("click keydown",$.proxy(a.onLoadMoreButtonClick,a)),a.debug===!0&&b.trigger("click"))},a.prototype.onLoadMoreButtonClick=function(a){var b=this;if("undefined"!=typeof a.keyCode&&13===a.keyCode||"undefined"==typeof a.keyCode){var c,d,e=$(a.currentTarget),f=e.parents(".block").eq(0);0!==f.length&&(c=f.find('ul[data-template-type="list"]').eq(0),d=b.compileListData(c),b.requestData(d,c))}},a.prototype.requestData=function(a,b){var c=this;$.ajax({url:c.requestUrl,type:"POST",data:a,success:$.proxy(c.onGetData,c,b)})},a.prototype.onGetData=function(a,b){var c=this;b&&c.expandList(a,b)},a.prototype.expandList=function(a,b){var c=this,d=a.clone(!0),e=b.Items.length,f=c.getAttr(d,"data-template-liststart","0"),g=d.find('[data-template-type="item"]').eq(0),h=parseInt(f,10)+e,i=a.parents(".block").eq(0).find(c.loadMoreSelector);0!==e?(d.attr("data-template-liststart",h+""),$(b.Items).each(function(a,b){var e=c.populateTemplate(g,b);d.append(e)}),a.replaceWith(d),h>=b.TotalNumberOfItems&&i.hide()):i.hide()},a.prototype.populateTemplate=function(a,b){var c=this,d=a.clone(!0),e=b.Properties[7].PropertyValue;return d.find('[data-template-type="property"]').each(function(a,d){var f=$(d),g=f.attr("data-template-property"),h=c.getAttr(f,"data-template-property-type",""),i=c.getAttr(f,"data-template-property-attribute",""),j=c.resolveDataProperty(b.Properties,g,"");if(0!==i.length)f.attr(i,j);else if(0!==h.length&&0!==j.length)switch(h){case"image":j&&0!==j.length&&(-1!==j.indexOf("</")?f.html(j):f.html('<img src="'+j+'" alt=""/>'))}else"publisheddate"===g&&"Nyheter"===e?j&&0!==j.length&&f.html(j.substr(0,10)):f.html(j)}),d},a.prototype.resolveDataProperty=function(a,b,c){var d="undefined"!=typeof c?c:"";return"undefined"!=typeof a&&0!==a.length&&a.forEach(function(a,c){a.PropertyName===b&&"undefined"!=typeof a.PropertyValue&&(d=a.PropertyValue)}),d},a.prototype.compileListData=function(a){var b=this,c={};return a.length>0&&(c.ContentLoader=b.getAttr(a,"data-template-contentloader",""),c.ListCount=b.getAttr(a,"data-template-listcount","3"),c.ArticleType=b.getAttr(a,"data-template-articletype",""),c.Source=b.getAttr(a,"data-template-source",""),c.ListStart=b.getAttr(a,"data-template-liststart","0"),c.ContentPropertyValues=[],c.PageId=b.getAttr(a,"data-template-pageid","0"),c.BlockId=b.getAttr(a,"data-template-blockid","0"),a.find('[data-template-type="item"]:eq(0)').find('[data-template-type="property"]').each(function(a,d){var e=$(d),f={PropertyName:"",Format:"",PropertyValue:""};f.PropertyName=b.getAttr(e,"data-template-property",""),f.Format=b.getAttr(e,"data-property-format",""),c.ContentPropertyValues.push(f)})),c},a.prototype.getAttr=function(a,b,c){var d="undefined"!=typeof c?c:"",e=a.attr(b);return e&&0!==e.length&&"undefined"!=typeof e||(e=d),e},a}();a.LayoutLoadMore=b}(b=a.Layout||(a.Layout={}))}(KWD||(KWD={}));